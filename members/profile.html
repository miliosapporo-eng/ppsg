<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Profile | 見つめる写真のはじめ型</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>if (localStorage.getItem('isMember') !== 'true') window.location.href = 'login.html';</script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
        .font-serif { font-family: 'Noto Serif JP', serif; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 pb-20">

    <div class="max-w-4xl mx-auto bg-gray-900 min-h-screen relative">
        <a href="index.html" class="absolute top-6 left-6 z-10 text-xs font-bold tracking-widest bg-black/50 px-4 py-2 rounded-full hover:bg-black transition-colors">← BACK</a>

        <div class="h-[50vh] w-full overflow-hidden">
            <img id="p-image" src="" class="w-full h-full object-cover">
        </div>

        <div class="px-6 py-12 md:px-12 -mt-20 relative z-20">
            <div class="bg-gray-800 p-8 md:p-12 border border-gray-700 shadow-2xl">
                <div class="flex flex-col md:flex-row justify-between items-start gap-6 mb-12 border-b border-gray-700 pb-8">
                    <div>
                        <span id="p-type" class="text-xs font-bold tracking-[0.2em] text-amber-500 uppercase mb-2 block">Type</span>
                        <h1 id="p-name" class="text-3xl md:text-4xl font-serif text-white mb-4">Name</h1>
                        <p id="p-location" class="text-sm text-gray-400 flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4"></i> Location</p>
                    </div>
                    <div id="p-contact-area">
                        </div>
                </div>

                <div class="mb-12">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-widest mb-4">Philosophy</h3>
                    <p id="p-philosophy" class="text-lg font-serif leading-loose text-gray-200">
                        </p>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-widest mb-4">Specs & Gear</h3>
                        <ul id="p-specs" class="space-y-4 text-sm text-gray-300">
                            </ul>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-widest mb-4">Terms</h3>
                        <p class="text-sm text-gray-300 leading-relaxed bg-gray-900 p-4 border border-gray-700">
                            【コミュニティ・ルール】<br>
                            マッチング時は必ず以下の「申請フォーマット」を使用してください。<br>
                            挨拶だけのDMや、条件未記入の依頼は返信されない場合があります。
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="request-modal" class="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white text-gray-900 w-full max-w-lg p-8 rounded-sm shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-900"><i data-lucide="x" class="w-6 h-6"></i></button>
            
            <h3 class="text-xl font-serif mb-2">Request Format</h3>
            <p class="text-xs text-gray-500 mb-6">以下の項目を埋めてコピーし、相手のDM/メールに送信してください。</p>

            <form class="space-y-4">
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest mb-1">1. Theme / Concept</label>
                    <input type="text" id="req-theme" class="w-full bg-gray-100 border-none p-3 text-sm" placeholder="例：都市と孤独、光の境界線">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold uppercase tracking-widest mb-1">2. Date</label>
                        <input type="text" id="req-date" class="w-full bg-gray-100 border-none p-3 text-sm" placeholder="例：10月頃の平日">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold uppercase tracking-widest mb-1">3. Location</label>
                        <input type="text" id="req-loc" class="w-full bg-gray-100 border-none p-3 text-sm" placeholder="例：都内スタジオ">
                    </div>
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest mb-1">4. Deliverables & Terms</label>
                    <textarea id="req-terms" rows="2" class="w-full bg-gray-100 border-none p-3 text-sm" placeholder="例：レタッチ済みデータ30枚、謝礼¥10,000+交通費"></textarea>
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest mb-1">5. Message</label>
                    <textarea id="req-msg" rows="2" class="w-full bg-gray-100 border-none p-3 text-sm" placeholder="あなたの〇〇という視点に共感し..."></textarea>
                </div>
            </form>

            <div class="mt-6 pt-6 border-t border-gray-200">
                <button onclick="copyRequest()" class="w-full bg-gray-900 text-white py-4 font-bold tracking-widest hover:bg-gray-700 transition-colors flex justify-center items-center gap-2">
                    <i data-lucide="copy" class="w-4 h-4"></i> COPY TEXT & OPEN DM
                </button>
                <p id="copy-msg" class="text-center text-green-600 text-xs mt-2 font-bold opacity-0 transition-opacity">COPIED!</p>
            </div>
        </div>
    </div>

    <script src="../js/members.js"></script>
    <script>
        lucide.createIcons();

        // URLからID取得
        const params = new URLSearchParams(window.location.search);
        const memberId = params.get('id');
        const member = membersData.find(m => m.id === memberId);

        if (!member) {
            alert('Member not found');
            window.location.href = 'index.html';
        }

        // データ反映
        document.getElementById('p-image').src = member.images[0];
        document.getElementById('p-type').innerText = member.type;
        document.getElementById('p-name').innerText = member.name;
        document.getElementById('p-location').innerHTML = `<i data-lucide="map-pin" class="w-4 h-4"></i> ${member.location}`;
        document.getElementById('p-philosophy').innerText = member.philosophy;

        // Specsリスト生成
        const specsList = document.getElementById('p-specs');
        for (const [key, value] of Object.entries(member.specs)) {
            const li = document.createElement('li');
            li.innerHTML = `<span class="text-gray-500 mr-2 capitalize">${key}:</span> ${value}`;
            specsList.appendChild(li);
        }

        // Contact Button生成
        const contactArea = document.getElementById('p-contact-area');
        if (member.status === 'Active') {
            contactArea.innerHTML = `
                <button onclick="openModal()" class="bg-white text-gray-900 px-8 py-3 text-xs font-bold tracking-widest hover:bg-gray-200 transition-colors shadow-lg">
                    REQUEST SHOOT
                </button>
            `;
        } else {
            contactArea.innerHTML = `
                <span class="bg-gray-700 text-gray-400 px-6 py-2 text-xs font-bold tracking-widest cursor-not-allowed">
                    NOT ACCEPTING
                </span>
            `;
        }

        // Modal Logic
        const modal = document.getElementById('request-modal');
        function openModal() { modal.classList.remove('hidden'); }
        function closeModal() { modal.classList.add('hidden'); }

        function copyRequest() {
            // テキスト生成
            const text = `
【撮影依頼: 見つめる写真のはじめ型より】

1. Theme: ${document.getElementById('req-theme').value}
2. Date: ${document.getElementById('req-date').value}
3. Location: ${document.getElementById('req-loc').value}
4. Terms: ${document.getElementById('req-terms').value}

Message:
${document.getElementById('req-msg').value}
            `.trim();

            // クリップボードにコピー
            navigator.clipboard.writeText(text).then(() => {
                document.getElementById('copy-msg').style.opacity = '1';
                setTimeout(() => {
                    // Instagramなどが設定されていれば開く
                    if (member.contact.instagram) {
                        window.open(member.contact.instagram, '_blank');
                    } else if (member.contact.email) {
                        window.location.href = member.contact.email;
                    }
                }, 1000);
            });
        }
    </script>
</body>
</html>
